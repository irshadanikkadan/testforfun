<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - AL FALAH ONLINE</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .dashboard-container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 8px 32px rgba(55,181,122,0.12); padding: 2rem; }
    h1 { color: #1f6b47; margin-bottom: 1.5rem; }
    .submission-list { margin-top: 2rem; }
    .submission-card { background: #f8fbf7; border-radius: 10px; padding: 1rem 1.2rem; margin-bottom: 1rem; border: 1px solid #e0e0e0; }
    .submission-card strong { color: #37b57a; }
    .empty { color: #888; text-align: center; margin-top: 2rem; }
    .delete-btn { background: #d9534f; color: #fff; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; float: right; }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <h1>Admin Dashboard</h1>
    <a href="/logout">Logout</a>
    <div id="submissionList" class="submission-list"></div>
  </div>
  <script>
    async function loadSubmissions() {
      try {
        const res = await fetch('/api/submissions');
        if (res.status === 401) {
            window.location.href = '/admin.html';
            return;
        }
        const data = await res.json();
        const list = document.getElementById('submissionList');
        if (!data.length) {
          list.innerHTML = '<div class="empty">No submissions yet.</div>';
          return;
        }
        list.innerHTML = data.map((sub, index) => `
          <div class="submission-card">
            <button class="delete-btn" onclick="deleteSubmission(${index})">Delete</button>
            <strong>Student:</strong> ${sub.studentName}<br>
            <strong>Parent:</strong> ${sub.parentName}<br>
            <strong>Email:</strong> ${sub.email}<br>
            <strong>Phone:</strong> ${sub.phone}<br>
            <strong>Grade:</strong> ${sub.grade}<br>
            <strong>Message:</strong> ${sub.message}<br>
            <small>Submitted: ${sub.timestamp}</small>
          </div>
        `).join('');
      } catch (err) {
        document.getElementById('submissionList').innerHTML = '<div class="empty">Error loading submissions.</div>';
      }
    }

    async function deleteSubmission(index) {
        if (confirm('Are you sure you want to delete this submission?')) {
            try {
                const response = await fetch('/api/submissions/' + index, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    loadSubmissions();
                } else {
                    alert('Failed to delete submission.');
                }
            } catch (err) {
                alert('An error occurred while deleting the submission.');
            }
        }
    }
    loadSubmissions();
  </script>
</body>
</html>
